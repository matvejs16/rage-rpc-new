!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports=r():e.rpc=r()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var e={d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};e.r(r),e.d(r,{call:()=>x,callBrowser:()=>D,callBrowsers:()=>T,callClient:()=>E,callServer:()=>C,default:()=>F,off:()=>J,on:()=>N,register:()=>R,trigger:()=>V,triggerBrowser:()=>A,triggerBrowsers:()=>I,triggerClient:()=>q,triggerServer:()=>U,unregister:()=>j});var t=function(e){return e.Blip="b",e.Checkpoint="cp",e.Colshape="c",e.Label="l",e.Marker="m",e.Object="o",e.Pickup="p",e.Player="pl",e.Vehicle="v",e}(t||{});function n(e,r){const n="client"===s();if(e&&"object"==typeof e&&void 0!==e.id){const o=(r,t,o)=>n?e.type===r&&t.at(e.id)===e:e instanceof o;switch(r){case t.Blip:return o("blip",mp.blips,mp.Blip);case t.Checkpoint:return o("checkpoint",mp.checkpoints,mp.Checkpoint);case t.Colshape:return o("colshape",mp.colshapes,mp.Colshape);case t.Label:return o("textlabel",mp.labels,mp.TextLabel);case t.Marker:return o("marker",mp.markers,mp.Marker);case t.Object:return o("object",mp.objects,mp.Object);case t.Pickup:return o("pickup",mp.pickups,mp.Pickup);case t.Player:return o("player",mp.players,mp.Player);case t.Vehicle:return o("vehicle",mp.vehicles,mp.Vehicle)}}return!1}function o(){const e=46656*Math.random()|0,r=46656*Math.random()|0;return("000"+e.toString(36)).slice(-3)+("000"+r.toString(36)).slice(-3)}function s(){return mp.joaat?"server":mp.game&&mp.game.joaat?"client":mp.trigger?"cef":void 0}function c(e){const r=s();return JSON.stringify(e,((e,o)=>{if("client"===r||"server"===r&&o&&"object"==typeof o){let e;if(n(o,t.Blip)?e=t.Blip:n(o,t.Checkpoint)?e=t.Checkpoint:n(o,t.Colshape)?e=t.Colshape:n(o,t.Marker)?e=t.Marker:n(o,t.Object)?e=t.Object:n(o,t.Pickup)?e=t.Pickup:n(o,t.Player)?e=t.Player:n(o,t.Vehicle)&&(e=t.Vehicle),e)return{__t:e,i:"number"==typeof o.remoteId?o.remoteId:o.id}}return o}))}function i(e){return new Promise((r=>setTimeout((()=>r(e)),0)))}function a(e){return new Promise(((r,t)=>setTimeout((()=>t(e)),0)))}function l(e,r){return"number"==typeof r?Promise.race([new Promise(((e,t)=>{setTimeout((()=>t("TIMEOUT")),r)})),e]):e}function p(e){try{e.url}catch(e){return!1}return!0}const u=s();if(!u)throw"Unknown RAGE environment";const g="PROCEDURE_NOT_FOUND",f=32e3,m="__rpc:id",h="__rpc:process",d="__rpc:processPartial",_="__rpc:browserRegister",w="__rpc:browserUnregister",v="__rpc:triggerEvent",b="__rpc:triggerEventBrowsers",y="cef"===u?window:e.g;if(y[d]||(y.__rpcPartialData={},y[d]=(e,r,t,n,o)=>{"server"!==u&&(o=n,n=t,t=r,r=e),y.__rpcPartialData[r]||(y.__rpcPartialData[r]=new Array(n)),y.__rpcPartialData[r][t]=o,y.__rpcPartialData[r].includes(void 0)||("server"!==u?y[h](y.__rpcPartialData[r].join("")):y[h](e,y.__rpcPartialData[r].join("")),delete y.__rpcPartialData[r])}),!y[h]){if(y.__rpcListeners={},y.__rpcPending={},y.__rpcEvListeners={},y[h]=(e,r)=>{"server"!==u&&(r=e);const n=function(e){const r=s();return JSON.parse(e,((e,n)=>{if(("client"===r||"server"===r)&&n&&"object"==typeof n&&"string"==typeof n.__t&&"number"==typeof n.i&&2===Object.keys(n).length){const e=n.i;let o;switch(n.__t){case t.Blip:o=mp.blips;break;case t.Checkpoint:o=mp.checkpoints;break;case t.Colshape:o=mp.colshapes;break;case t.Label:o=mp.labels;break;case t.Marker:o=mp.markers;break;case t.Object:o=mp.objects;break;case t.Pickup:o=mp.pickups;break;case t.Player:o=mp.players;break;case t.Vehicle:o=mp.vehicles}if(o)return o["client"===r?"atRemoteId":"at"](e)}return n}))}(r);if(n.req){const r={id:n.id,environment:n.fenv||n.env};"server"===u&&(r.player=e);const t={ret:1,id:n.id,env:u};let o;switch(u){case"server":o=e=>r.player.call(h,[c(e)]);break;case"client":if("server"===n.env)o=e=>mp.events.callRemote(h,c(e));else if("cef"===n.env){const e=n.b&&y.__rpcBrowsers[n.b];r.browser=e,o=r=>e&&p(e)&&P(e,r,!0)}break;case"cef":o=e=>mp.trigger(h,c(e))}if(o){const e=k(n.name,n.args,r);n.noRet||e.then((e=>o({...t,res:e}))).catch((e=>o({...t,err:e||null})))}}else if(n.ret){const r=y.__rpcPending[n.id];if("server"===u&&r.player!==e)return;r&&(r.resolve(n.hasOwnProperty("err")?a(n.err):i(n.res)),delete y.__rpcPending[n.id])}},"cef"!==u){if(mp.events.add(h,y[h]),mp.events.add(d,y[d]),"client"===u){R("__rpc:callServer",(([e,r,t],n)=>O(e,r,{fenv:n.environment,noRet:t}))),R("__rpc:callBrowsers",(([e,r,t],n)=>M(null,e,r,{fenv:n.environment,noRet:t}))),y.__rpcBrowsers={};const e=e=>{const r=o();Object.keys(y.__rpcBrowsers).forEach((r=>{const t=y.__rpcBrowsers[r];t&&p(t)&&t!==e||delete y.__rpcBrowsers[r]})),y.__rpcBrowsers[r]=e,e.execute(`\n                    window.name = '${r}';\n                    if(typeof window['${m}'] === 'undefined'){\n                        window['${m}'] = Promise.resolve(window.name);\n                    }else{\n                        window['${m}:resolve'](window.name);\n                    }\n                `)};mp.browsers.forEach(e),mp.events.add("browserCreated",e),y.__rpcBrowserProcedures={},mp.events.add(_,(e=>{const[r,t]=JSON.parse(e);y.__rpcBrowserProcedures[t]=r})),mp.events.add(w,(e=>{const[r,t]=JSON.parse(e);y.__rpcBrowserProcedures[t]===r&&delete y.__rpcBrowserProcedures[t]})),R(b,(([e,r],t)=>{Object.values(y.__rpcBrowsers).forEach((n=>{L(n,v,[e,r],{fenv:t.environment,noRet:1})}))}))}}else void 0===y[m]&&(y[m]=new Promise((e=>{window.name?e(window.name):y[m+":resolve"]=e})));R(v,(([e,r],t)=>$(e,r,t)))}function P(e,r,t){const n=c(r);e.execute(`var process = window["${h}"]; if(process){ process(${JSON.stringify(n)}); }else{ ${t?"":`mp.trigger("${h}", '{"ret":1,"id":"${r.id}","err":"${g}","env":"cef"}');`} }`)}function k(e,r,t){const n=y.__rpcListeners[e];return n?i(n(r,t)):a(g)}function B(e,r){const t={client:(e,...r)=>mp.events.callRemote(e,...r),server:(e,...t)=>r.call(e,[...t])},n=e.env,o=c(e);if(o.length>f){const r=function(e,r){const t=Math.ceil(e.length/r),n=new Array(t);let o=0;for(let s=0;s<t;s+=1)n[s]=e.substr(o,r),o+=r;return n}(o,f);r.forEach(((o,s)=>{t[n](d,e.id,s,r.length,o)}))}else t[n](h,o)}function R(e,r){if(2!==arguments.length)throw'register expects 2 arguments: "name" and "cb"';return"cef"===u&&y[m].then((r=>mp.trigger(_,JSON.stringify([r,e])))),y.__rpcListeners[e]=r,()=>j(e)}function j(e){if(1!==arguments.length)throw'unregister expects 1 argument: "name"';"cef"===u&&y[m].then((r=>mp.trigger(w,JSON.stringify([r,e])))),y.__rpcListeners[e]=void 0}function x(e,r,t={}){return arguments.length<1||arguments.length>3?a('call expects 1 to 3 arguments: "name", optional "args", and optional "options"'):l(k(e,r,{environment:u}),t.timeout)}function O(e,r,t={}){switch(u){case"server":return x(e,r);case"client":{const n=o();return new Promise((o=>{t.noRet||(y.__rpcPending[n]={resolve:o}),B({req:1,id:n,name:e,env:u,args:r,...t})}))}case"cef":return E("__rpc:callServer",[e,r,+t.noRet])}}function C(e,r,t={}){if(arguments.length<1||arguments.length>3)return a('callServer expects 1 to 3 arguments: "name", optional "args", and optional "options"');let n={};return t.noRet&&(n.noRet=1),l(O(e,r,n),t.timeout)}function S(e,r,t,n={}){switch(u){case"client":return x(r,t);case"server":{const s=o();return new Promise((o=>{n.noRet||(y.__rpcPending[s]={resolve:o,player:e}),B({req:1,id:s,name:r,env:u,args:t,...n},e)}))}case"cef":{const e=o();return y[m].then((o=>new Promise((s=>{n.noRet||(y.__rpcPending[e]={resolve:s});const i={b:o,req:1,id:e,name:r,env:u,args:t,...n};mp.trigger(h,c(i))}))))}}}function E(e,r,t,n={}){switch(u){case"client":if(n=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return a('callClient from the client expects 1 to 3 arguments: "name", optional "args", and optional "options"');break;case"server":if(arguments.length<2||arguments.length>4||"object"!=typeof e)return a('callClient from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');break;case"cef":if(n=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return a('callClient from the browser expects 1 to 3 arguments: "name", optional "args", and optional "options"')}let o={};return n.noRet&&(o.noRet=1),l(S(e,r,t,o),n.timeout)}function L(e,r,t,n={}){return new Promise((s=>{const c=o();n.noRet||(y.__rpcPending[c]={resolve:s}),P(e,{req:1,id:c,name:r,env:u,args:t,...n},!1)}))}function M(e,r,t,n={}){switch(u){case"client":const o=y.__rpcBrowserProcedures[r];if(!o)return a(g);const s=y.__rpcBrowsers[o];return s&&p(s)?L(s,r,t,n):a(g);case"server":return S(e,"__rpc:callBrowsers",[r,t,+n.noRet],n);case"cef":return S(null,"__rpc:callBrowsers",[r,t,+n.noRet],n)}}function T(e,r,t,n={}){let o,s={};switch(u){case"client":case"cef":if(n=t||{},t=r,r=e,arguments.length<1||arguments.length>3)return a('callBrowsers from the client or browser expects 1 to 3 arguments: "name", optional "args", and optional "options"');n.noRet&&(s.noRet=1),o=M(null,r,t,s);break;case"server":if(arguments.length<2||arguments.length>4)return a('callBrowsers from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');n.noRet&&(s.noRet=1),o=M(e,r,t,s)}if(o)return l(o,n.timeout)}function D(e,r,t,n={}){if("client"!==u)return a("callBrowser can only be used in the client environment");if(arguments.length<2||arguments.length>4)return a('callBrowser expects 2 to 4 arguments: "browser", "name", optional "args", and optional "options"');let o={};return n.noRet&&(o.noRet=1),l(L(e,r,t,o),n.timeout)}function $(e,r,t){const n=y.__rpcEvListeners[e];n&&n.forEach((e=>e(r,t)))}function N(e,r){if(2!==arguments.length)throw'on expects 2 arguments: "name" and "cb"';const t=y.__rpcEvListeners[e]||new Set;return t.add(r),y.__rpcEvListeners[e]=t,()=>J(e,r)}function J(e,r){if(2!==arguments.length)throw'off expects 2 arguments: "name" and "cb"';const t=y.__rpcEvListeners[e];t&&t.delete(r)}function V(e,r){if(arguments.length<1||arguments.length>2)throw'trigger expects 1 or 2 arguments: "name", and optional "args"';$(e,r,{environment:u})}function q(e,r,t){switch(u){case"client":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the client expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3||"object"!=typeof e)throw'triggerClient from the server expects 2 or 3 arguments: "player", "name", and optional "args"';break;case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the browser expects 1 or 2 arguments: "name", and optional "args"'}S(e,v,[r,t],{noRet:1})}function U(e,r){if(arguments.length<1||arguments.length>2)throw'triggerServer expects 1 or 2 arguments: "name", and optional "args"';O(v,[e,r],{noRet:1})}function I(e,r,t){switch(u){case"client":case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2)throw'triggerBrowsers from the client or browser expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3)throw'triggerBrowsers from the server expects 2 or 3 arguments: "player", "name", and optional "args"'}S(e,b,[r,t],{noRet:1})}function A(e,r,t){if("client"!==u)throw"callBrowser can only be used in the client environment";if(arguments.length<2||arguments.length>4)throw'callBrowser expects 2 or 3 arguments: "browser", "name", and optional "args"';L(e,v,[r,t],{noRet:1})}const F={register:R,unregister:j,call:x,callServer:C,callClient:E,callBrowsers:T,callBrowser:D,on:N,off:J,trigger:V,triggerServer:U,triggerClient:q,triggerBrowsers:I,triggerBrowser:A};return r})()));